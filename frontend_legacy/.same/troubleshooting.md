# AI Workflow 故障排除指南

## 🔧 常见问题和解决方案

### 问题1：拉出节点选择器时UI出错，无法打开程序

**症状**：
- 拖动连接线选择图片或视频节点时程序崩溃
- 页面白屏或无响应
- 控制台显示验证错误

**原因**：
- 浏览器缓存了旧版本的节点数据
- 新节点类型与旧数据不兼容
- localStorage中的持久化数据格式已过时

**解决方案**：

#### 方法1：清除浏览器缓存（推荐）
1. 按 `F12` 打开开发者工具
2. 右键点击刷新按钮
3. 选择"清空缓存并硬性重新加载"
4. 或者按 `Ctrl+Shift+Delete` 清除浏览器数据

#### 方法2：清除localStorage
1. 按 `F12` 打开开发者工具
2. 切换到"控制台"(Console)标签
3. 输入以下命令并回车：
   ```javascript
   localStorage.clear()
   location.reload()
   ```

#### 方法3：使用新的persistenceKey
项目已自动更新到 `workflow-v3-chain`，刷新页面即可。

### 问题2：节点显示异常或缺失属性

**症状**：
- 节点内容显示不完整
- 某些功能按钮消失
- 节点高度计算错误

**原因**：
- 节点数据模型已更新
- 旧的持久化数据使用旧模型

**解决方案**：
1. 清除localStorage（见问题1）
2. 重新创建节点
3. 导出重要的生成内容后再清除

### 问题3：图片/视频无法继续创作

**症状**：
- 悬停在生成内容上没有显示"继续创作"按钮
- 点击按钮没有反应

**可能原因**：
- CSS样式未正确加载
- JavaScript事件处理被阻止

**解决方案**：
1. 刷新页面
2. 检查浏览器控制台是否有错误
3. 确保悬停时间足够长（>0.2秒）

### 问题4：连接线无法创建

**症状**：
- 拖拽端口时无法创建连接
- 连接线显示但无法连接到目标

**解决方案**：
1. 确保从输出端口（右侧蓝点）拖到输入端口（左侧蓝点）
2. 检查是否选中了正确的工具（应该是选择工具）
3. 重新加载页面

### 问题5：AI聊天面板无法打开

**症状**：
- 点击聊天面板图标没有反应
- 面板只显示部分内容

**解决方案**：
1. 检查屏幕分辨率是否足够（推荐≥1280px宽度）
2. 清除浏览器缓存
3. 检查是否有JavaScript错误

### 问题6：生成的图片/视频不显示

**症状**：
- 节点执行后没有显示内容
- 显示加载状态但从不完成

**原因**：
- 当前使用模拟数据
- 需要配置真实API密钥

**解决方案**：
1. 等待模拟生成完成（2-3秒）
2. 配置 `.env` 文件中的API密钥
3. 重启开发服务器

### 问题7：页面性能下降

**症状**：
- 画布操作延迟
- 节点创建缓慢
- 浏览器卡顿

**原因**：
- 节点数量过多（>50个）
- 生成内容占用大量内存
- 浏览器资源不足

**解决方案**：
1. 删除不需要的节点
2. 定期保存并重新开始
3. 清理浏览器缓存
4. 使用较新的浏览器版本

## 🛠️ 调试技巧

### 查看控制台错误
1. 按 `F12` 打开开发者工具
2. 切换到"控制台"(Console)标签
3. 查找红色错误消息
4. 复制完整的错误栈追踪

### 检查网络请求
1. 开发者工具 → "网络"(Network)标签
2. 刷新页面
3. 检查是否有失败的请求（红色）
4. 查看请求详情和响应

### 查看localStorage数据
```javascript
// 查看所有存储的数据
console.log(localStorage)

// 查看特定键的数据
console.log(localStorage.getItem('workflow-v3-chain'))

// 清除特定键
localStorage.removeItem('workflow-v3-chain')

// 清除所有数据
localStorage.clear()
```

### 检查节点数据
```javascript
// 在控制台中访问编辑器实例
const editor = window.editor

// 获取所有节点
const nodes = editor.getCurrentPageShapes().filter(s => s.type === 'node')
console.log(nodes)

// 查看节点属性
nodes.forEach(node => {
  console.log(node.type, node.props)
})
```

## 📋 报告问题清单

如果以上方法都无法解决问题，请收集以下信息：

1. **浏览器信息**
   - 浏览器名称和版本
   - 操作系统

2. **错误信息**
   - 控制台错误消息
   - 错误发生的步骤

3. **环境信息**
   - Node.js版本：`node --version`
   - Bun版本：`bun --version`
   - 项目版本号

4. **重现步骤**
   - 详细的操作步骤
   - 预期行为 vs 实际行为
   - 截图或视频（如果可能）

## 🔄 完整重置步骤

如果需要完全重置项目：

### 步骤1：清除所有缓存
```bash
# 清除Vite缓存
cd ai-workflow
rm -rf node_modules/.vite

# 清除dist目录
rm -rf dist
```

### 步骤2：清除浏览器数据
1. 打开浏览器开发者工具
2. 应用程序 → 本地存储 → 删除所有workflow相关的键
3. 清除浏览器缓存

### 步骤3：重新安装依赖（可选）
```bash
rm -rf node_modules
bun install
```

### 步骤4：重启开发服务器
```bash
bun run dev
```

### 步骤5：验证修复
1. 打开浏览器访问 http://localhost:5173
2. 创建一个输入节点
3. 创建一个图片生成节点
4. 测试连接功能
5. 测试继续创作功能

## 💡 预防措施

### 定期维护
- 每周清理一次不需要的节点
- 定期导出重要的生成内容
- 保持浏览器和依赖更新

### 最佳实践
- 控制工作流节点数量（<50个）
- 使用合理的图片尺寸
- 避免同时生成大量内容
- 定期保存工作进度

### 备份策略
- 截图保存重要的工作流
- 导出生成的图片和视频
- 记录成功的参数配置

---

**最后更新**：2025-11-02
**版本**：v31
**状态**：已修复节点选择器UI错误
