# Version 44: 工具面板集成 tldraw 系统工具

## 概述

Version 44 重新设计了"工具"面板，现在点击工具图标时会显示 tldraw 的系统绘图工具，而不仅仅是 AI 节点列表。这使得工作流程更加专业和完整，用户可以在同一个界面中使用绘图工具和 AI 生成工具。

## 主要改进

### 1. 工具面板重新组织

点击左侧"工具"▦图标后，右侧面板现在按类别显示：

#### 基础工具
| 工具 | 快捷键 | 功能 |
|------|--------|------|
| 选择工具 | V | 选择和移动对象 |
| 手型工具 | H | 平移画布 |

#### 绘图工具
| 工具 | 快捷键 | 功能 |
|------|--------|------|
| 画笔工具 | D | 自由绘制路径 |
| 橡皮擦 | E | 擦除绘制内容 |
| 激光笔 | L | 临时激光指示 |

#### 形状工具
| 工具 | 快捷键 | 功能 |
|------|--------|------|
| 矩形 | R | 绘制矩形 |
| 椭圆 | O | 绘制圆形/椭圆 |
| 三角形 | T | 绘制三角形 |
| 菱形 | - | 绘制菱形 |
| 六边形 | - | 绘制六边形 |
| 星形 | - | 绘制星形 |

#### 文本和箭头
| 工具 | 快捷键 | 功能 |
|------|--------|------|
| 文本 | T | 添加文本标签 |
| 箭头 | A | 绘制箭头连接 |
| 直线 | - | 绘制直线 |

#### AI 节点（底部）
- 文本输入节点
- 图片生成节点
- 视频生成节点
- 文本生成节点

### 2. 快速访问面板更新

快速访问面板现在包含更多样化的工具：

```
┌──────────┬──────────┐
│  画笔    │  文本    │
├──────────┼──────────┤
│  矩形    │  箭头    │
├──────────┼──────────┤
│文本输入  │图片生成  │
└──────────┴──────────┘
```

这样用户可以快速访问：
- **常用绘图工具**：画笔、文本、矩形、箭头
- **常用AI节点**：文本输入、图片生成

### 3. 工具激活逻辑

点击工具后的行为：

```typescript
// tldraw 系统工具
if (tldrawTools.includes(nodeType)) {
  // 激活 tldraw 对应的工具
  editor.setCurrentTool(nodeType)
  // 关闭面板
  setActiveTool(null)
}

// AI 自定义节点
else {
  // 在画布中心创建节点
  editor.createShape({ type: 'node', ... })
  // 关闭面板
  setActiveTool(null)
}
```

### 4. 快捷键显示

每个工具右侧显示其键盘快捷键：

```css
[工具图标] 工具名称        [V]
                       ↑快捷键标签
```

样式特点：
- 浅灰色背景
- 小字号（11px）
- 圆角标签
- 右对齐显示

## 使用场景

### 场景1：使用绘图工具标注

```
1. 点击左侧"工具"图标
2. 选择"画笔工具"
3. 在画布上绘制标注
4. 按 V 切回选择工具
```

### 场景2：添加文本说明

```
1. 点击左侧"快速访问"
2. 点击"文本"卡片
3. 点击画布添加文本
4. 输入说明内容
```

### 场景3：创建流程图

```
1. 从"工具"面板选择矩形
2. 绘制多个矩形框
3. 选择箭头工具
4. 连接各个矩形
5. 添加文本标签
```

### 场景4：AI工作流 + 手绘标注

```
1. 使用AI节点生成图片
2. 切换到画笔工具
3. 在生成的图片上手绘标注
4. 添加文本说明
5. 使用箭头指示重点
```

## 技术实现

### 工具分类

```typescript
const tldrawTools = [
  // 基础工具
  'select', 'hand',

  // 绘图工具
  'draw', 'eraser', 'laser',

  // 形状工具
  'rectangle', 'ellipse', 'triangle',
  'diamond', 'hexagon', 'star',

  // 文本和箭头
  'text', 'arrow', 'line'
]
```

### 工具映射

```typescript
// 形状工具映射到 geo 类型
if (['rectangle', 'ellipse', 'triangle', ...].includes(nodeType)) {
  editor.setCurrentTool('geo')
}

// 其他工具直接映射
else {
  editor.setCurrentTool(nodeType)
}
```

### 面板UI组件

```jsx
<button className="panel-list-item" onClick={...}>
  <svg>工具图标</svg>
  <span>工具名称</span>
  <span className="panel-tool-shortcut">快捷键</span>
</button>
```

## 设计改进

### 1. 工具组织更清晰
- 按功能类型分组
- 每组有明确标题
- 从基础到高级排序

### 2. 快捷键可见性
- 每个工具显示快捷键
- 帮助用户快速记忆
- 提升操作效率

### 3. 系统工具优先
- tldraw 工具在前
- AI 节点在后
- 符合用户使用习惯

### 4. 快速访问优化
- 混合显示绘图和AI工具
- 平衡不同使用场景
- 6个最常用工具

## 与 weavy.ai 的对比

### weavy.ai 设计
- 左侧窄工具栏
- 点击展开详细面板
- 显示AI模型和工具卡片
- 混合系统工具和AI工具

### 我们的实现
- ✅ 左侧60px图标工具栏
- ✅ 点击展开280px面板
- ✅ 分类显示系统工具
- ✅ AI节点单独分组
- ✅ 快捷键标签显示
- ✅ 工具卡片和列表混合布局

## 优势

### 1. 专业性
- 完整的绘图工具集
- 符合设计软件标准
- 快捷键支持

### 2. 灵活性
- 可以纯手绘
- 可以纯AI生成
- 可以混合使用

### 3. 学习曲线
- 快捷键提示
- 清晰分类
- 渐进式学习

### 4. 工作流完整性
```
手绘草图 → AI生成 → 手动调整 → AI优化
   ↑                              ↓
   └──────────── 完整闭环 ──────────┘
```

## 下一步改进

### 功能增强
- [ ] 添加工具说明tooltip
- [ ] 显示当前激活的工具
- [ ] 工具使用教程
- [ ] 最近使用工具记录
- [ ] 自定义快速访问

### 用户体验
- [ ] 工具预览图示
- [ ] 交互式教程
- [ ] 快捷键速查表
- [ ] 工具组合推荐

### 性能优化
- [ ] 工具切换动画
- [ ] 面板缓存
- [ ] 懒加载工具图标

## 测试清单

- [x] 点击"工具"图标展开面板
- [ ] 点击基础工具激活对应功能
- [ ] 点击绘图工具激活画笔等
- [ ] 点击形状工具可绘制形状
- [ ] 点击文本工具可添加文本
- [ ] 点击箭头工具可绘制箭头
- [ ] 点击AI节点创建节点
- [ ] 快捷键正确显示
- [ ] 工具分类清晰
- [ ] 面板滚动流畅

## 相关文件

- `/ai-workflow/src/components/SidePanel.tsx` - 面板组件（工具列表）
- `/ai-workflow/src/components/SidePanel.css` - 快捷键样式
- `/ai-workflow/src/App.tsx` - 工具激活逻辑

## 版本信息

- **版本号**: v44
- **日期**: 2025-11-03
- **主要改进**: 工具面板集成tldraw系统工具
- **兼容性**: ✅ 完全向后兼容
- **参考设计**: weavy.ai 工具面板

## 快速上手

### 第一次使用？

1. **点击"快速访问"⭐** - 查看常用工具
2. **点击"工具"▦** - 浏览所有可用工具
3. **注意快捷键** - 右侧灰色标签是快捷键
4. **混合使用** - 绘图工具 + AI节点 = 无限可能

### 键盘快捷键

| 按键 | 工具 |
|------|------|
| V | 选择 |
| H | 手型 |
| D | 画笔 |
| E | 橡皮擦 |
| T | 文本 |
| R | 矩形 |
| O | 椭圆 |
| A | 箭头 |

---

**更新**: v44
**状态**: ✅ 已完成
**下一步**: 测试工具激活功能
