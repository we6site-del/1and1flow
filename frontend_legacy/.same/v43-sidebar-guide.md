# Version 43: 图标式侧边栏和可展开面板系统

## 概述

Version 43 完全重新设计了左侧工具栏，采用现代化的图标式导航，参考了 Figma、Canva 等专业设计工具的交互模式。点击左侧图标后，右侧会展开对应的工具面板，提供更大的操作空间和更清晰的工具组织。

## 主要特性

### 1. 图标式左侧工具栏

#### 位置和尺寸
- **宽度**: 60px
- **位置**: 固定在屏幕最左侧
- **背景**: 纯白色
- **边框**: 右侧1px浅灰色边框

#### 工具图标列表

1. **Logo** (顶部)
   - 品牌标识
   - 点击可返回首页或刷新

2. **搜索**
   - 图标: 🔍 放大镜
   - 点击展开搜索面板
   - 可搜索节点、模型、资产

3. **快速访问** ⭐
   - 图标: 星星
   - 常用节点的快捷方式
   - 网格卡片展示

4. **工具**
   - 图标: 四方格
   - 所有可用节点的完整列表
   - 按类别分组显示

5. **图片模型** 🖼️
   - 图标: 图片框
   - 图片生成模型列表
   - 快速添加图片生成节点

6. **视频模型** 🎬
   - 图标: 摄像机
   - 视频生成模型列表
   - 快速添加视频生成节点

7. **模版** 📐
   - 图标: 布局
   - 预设工作流模版
   - 一键创建工作流

8. **项目资产** 📁
   - 图标: 文件夹
   - 上传和管理图片、视频等资源
   - 资产库

#### 交互状态

```css
/* 默认状态 */
color: rgba(0, 0, 0, 0.6)
background: transparent

/* Hover 悬停 */
color: #3b82f6 (蓝色)
background: rgba(59, 130, 246, 0.08)

/* Active 激活 */
color: #3b82f6
background: rgba(59, 130, 246, 0.12)
left-border: 3px 蓝色竖线
```

### 2. 可展开右侧面板

#### 位置和尺寸
- **宽度**: 280px
- **位置**: 左侧工具栏右侧（60px起始）
- **高度**: 全屏高度
- **动画**: 0.2s 滑入动画

#### 面板结构

```
┌─────────────────────────────┐
│ [标题]            [关闭按钮] │ ← Header
├─────────────────────────────┤
│                             │
│                             │
│        面板内容              │ ← Content (可滚动)
│                             │
│                             │
└─────────────────────────────┘
```

#### 面板内容详解

##### 1. 搜索面板
```
┌─────────────────────────────┐
│ [搜索框]                     │
│ ┌─────────────────────────┐ │
│ │ 搜索节点、模型、资产...  │ │
│ └─────────────────────────┘ │
│                             │
│ 搜索结果:                    │
│ - 匹配的节点                │
│ - 匹配的模型                │
│ - 匹配的资产                │
└─────────────────────────────┘
```

##### 2. 快速访问面板
2x2 网格卡片，每个卡片包含：
- 图标（40x40）
- 节点名称
- Hover 效果：上浮 + 阴影

可用节点：
- 文本输入
- 图片生成
- 视频生成
- 文本生成

##### 3. 工具面板（完整节点列表）
按类别分组：

**输入节点**
- 文本输入

**生成节点**
- 图片生成
- 视频生成
- 文本生成

每个条目：
- 左侧图标
- 节点名称
- 点击添加到画布中心

##### 4. 图片模型面板
模型列表卡片，每个包含：
- 模型图标
- 模型名称
- 模型描述
- 点击添加图片生成节点

可用模型：
- Flux Pro 1.1
- Seedream 4
- Stable Diffusion 3.5
- DALL-E 3
- Midjourney

##### 5. 视频模型面板
模型列表卡片，每个包含：
- 模型图标
- 模型名称
- 模型描述
- 点击添加视频生成节点

可用模型：
- Runway Gen-3
- Luma Dream Machine
- Pika 2.0
- Kling AI

##### 6. 模版面板
工作流模版网格：

可用模版：
- 图片生成工作流（文本→图片）
- 视频制作流程（图片→视频）
- 批量生成（批量变体）
- 风格迁移（艺术风格）

每个模版卡片：
- 预览图（16:9）
- 模版名称
- 模版描述
- 点击应用模版

##### 7. 项目资产面板
```
┌─────────────────────────────┐
│                    [上传按钮] │
├─────────────────────────────┤
│                             │
│     [暂无资产]               │
│     上传图片、视频等资源      │
│                             │
└─────────────────────────────┘
```

功能：
- 上传资产按钮
- 资产网格显示
- 资产预览
- 拖拽到画布使用

### 3. 节点添加功能

#### 添加位置
当从面板点击添加节点时：
```typescript
// 计算视口中心
const { w, h } = editor.getViewportPageBounds()
const centerX = w / 2
const centerY = h / 2

// 在中心创建节点（有偏移以居中节点本身）
editor.createShape({
  type: 'node',
  x: centerX - 150,
  y: centerY - 100,
  props: { node: { type: nodeType } }
})
```

#### 自动关闭
添加节点后自动关闭面板，保持画布清爽

## 设计原则

### 1. 渐进式展示
- 左侧工具栏始终可见，占用最小空间
- 点击后才展开详细面板
- 可随时关闭面板回到简洁状态

### 2. 白色主题一致性
- 所有UI使用白色背景
- 浅灰色边框和分隔线
- 蓝色作为主题色（#3b82f6）
- 保持整体视觉统一

### 3. 流畅交互
- 所有动画 0.2s 过渡
- Hover 状态清晰反馈
- 点击响应即时

### 4. 图标优先
- 简洁的SVG图标
- 20x20 标准尺寸
- 配合 tooltip 说明

## 使用场景

### 场景1: 快速添加常用节点
```
1. 点击"快速访问"图标
2. 从2x2网格中选择节点
3. 节点添加到画布中心
4. 面板自动关闭
```

### 场景2: 浏览所有工具
```
1. 点击"工具"图标
2. 查看分类的节点列表
3. 点击任意节点添加
4. 继续浏览或关闭面板
```

### 场景3: 选择AI模型
```
1. 点击"图片模型"或"视频模型"
2. 浏览可用模型列表
3. 点击模型名称
4. 对应的生成节点添加到画布
```

### 场景4: 使用模版
```
1. 点击"模版"图标
2. 查看预设工作流
3. 点击模版应用
4. 完整工作流自动创建
```

### 场景5: 管理资产
```
1. 点击"项目资产"
2. 点击上传按钮
3. 选择文件上传
4. 从资产库拖拽到画布使用
```

## 技术实现

### 组件结构
```
App.tsx
├── Sidebar.tsx (左侧工具栏)
│   ├── Logo
│   ├── 工具图标列表
│   └── 状态管理
└── SidePanel.tsx (右侧面板)
    ├── 面板头部
    ├── 面板内容（根据工具类型）
    └── 关闭功能
```

### 状态管理
```typescript
const [activeTool, setActiveTool] = useState<SidebarTool | null>(null)

// 点击工具图标
const handleToolClick = (tool) => {
  const newTool = activeTool === tool ? null : tool
  setActiveTool(newTool)
}

// 关闭面板
const handleClose = () => {
  setActiveTool(null)
}
```

### 样式特点
```css
/* 左侧栏固定定位 */
.sidebar {
  position: fixed;
  left: 0;
  width: 60px;
  z-index: 1000;
}

/* 右侧面板滑入动画 */
.side-panel {
  position: fixed;
  left: 60px;
  width: 280px;
  animation: slideIn 0.2s ease-out;
}

/* 画布左移 */
.tl-container {
  margin-left: 60px;
}
```

## 键盘快捷键（计划中）

- `Cmd/Ctrl + K` - 打开搜索面板
- `Cmd/Ctrl + E` - 打开快速访问
- `Cmd/Ctrl + T` - 打开工具列表
- `ESC` - 关闭面板

## 下一步改进

### 功能增强
- [ ] 实现搜索功能（实时搜索节点和模型）
- [ ] 添加最近使用记录
- [ ] 支持自定义快速访问
- [ ] 模版库完整实现
- [ ] 资产上传和管理
- [ ] 拖拽添加节点
- [ ] 右键菜单集成

### 性能优化
- [ ] 面板内容懒加载
- [ ] 虚拟滚动（大量条目时）
- [ ] 面板缓存

### 用户体验
- [ ] 键盘快捷键
- [ ] 面板大小可调整
- [ ] 记住用户上次打开的面板
- [ ] 工具说明和教程
- [ ] 搜索历史

## 相关文件

- `/ai-workflow/src/components/Sidebar.tsx` - 左侧工具栏组件
- `/ai-workflow/src/components/Sidebar.css` - 工具栏样式
- `/ai-workflow/src/components/SidePanel.tsx` - 右侧面板组件
- `/ai-workflow/src/components/SidePanel.css` - 面板样式
- `/ai-workflow/src/App.tsx` - 主应用集成
- `/ai-workflow/src/index.css` - 全局样式调整

## 版本信息

- **版本号**: v43
- **发布日期**: 2025-11-03
- **主要改进**: 图标式侧边栏 + 可展开面板系统
- **向后兼容**: ✅ 完全兼容
- **参考设计**: Figma, weavy.ai, Canva

## 测试清单

- [x] 左侧工具栏正确显示
- [x] 8个工具图标正确渲染
- [ ] 点击图标展开对应面板
- [ ] 面板滑入动画流畅
- [ ] 点击关闭按钮关闭面板
- [ ] 点击背景外部关闭面板
- [ ] 从面板添加节点到画布中心
- [ ] Hover状态正确显示
- [ ] Active状态正确显示
- [ ] 面板内容可滚动
- [ ] 所有交互元素可点击
- [ ] 白色主题一致性
