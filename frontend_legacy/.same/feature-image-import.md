# 图片导入功能文档

## 概述
图片导入功能允许用户从本地文件系统选择一张或多张图片，并将它们自动添加到画布中。

## 功能特点

### 1. 多图片支持
- 支持一次选择多张图片
- 自动排列多张图片，避免重叠
- 使用网格布局（每行3张图片）

### 2. 自动尺寸调整
- 自动检测图片原始尺寸
- 如果图片超过400px，自动缩放
- 保持图片宽高比

### 3. 智能位置
- 图片添加到视口中心
- 多张图片自动偏移，形成整齐的网格

### 4. 支持的格式
- 所有常见图片格式（JPEG, PNG, GIF, WebP等）
- 通过浏览器的文件选择器限制

## 使用方法

### 从工具面板导入
1. 点击左侧边栏的"工具"图标
2. 在侧面板中找到"导入工具"分类
3. 点击"导入图片"按钮
4. 在文件选择器中选择一张或多张图片
5. 图片会自动添加到画布中心

## 技术实现

### 核心代码位置
- `src/components/SidePanel.tsx` - 图片导入逻辑
- 使用 FileReader API 读取图片文件
- 使用 tldraw Editor API 创建资产和形状

### 实现流程
```typescript
1. 创建文件输入元素（input[type=file]）
2. 监听文件选择事件
3. 使用FileReader读取文件为DataURL
4. 创建Image对象获取图片尺寸
5. 计算合适的显示尺寸（最大400px）
6. 使用editor.createAssets创建图片资产
7. 使用editor.createShape创建图片形状
8. 自动关闭侧面板
```

### 关键API
- `editor.getViewportPageBounds()` - 获取视口边界
- `editor.createAssets([...])` - 创建图片资产
- `editor.createShape({...})` - 创建图片形状

## 配置选项

### 最大尺寸
```typescript
const maxSize = 400 // 可以修改此值调整最大显示尺寸
```

### 网格布局
```typescript
const offsetX = (index % 3) * 50 // 每行3张图片
const offsetY = Math.floor(index / 3) * 50 // 行间距50px
```

## 后续改进建议

1. **拖拽导入**
   - 支持直接拖拽图片到画布
   - 在拖拽位置创建图片

2. **图片编辑**
   - 添加裁剪功能
   - 添加滤镜和调整功能

3. **批量管理**
   - 显示导入进度
   - 支持批量删除和替换

4. **云端存储**
   - 将图片上传到云存储
   - 减少本地存储压力

5. **图片优化**
   - 自动压缩大图片
   - 转换格式以优化性能

## 测试指南

### 基本测试
1. 打开应用并进入画布
2. 点击工具面板中的"导入图片"
3. 选择一张图片
4. 验证图片是否正确显示在画布中心

### 多图片测试
1. 点击"导入图片"
2. 使用Ctrl/Cmd选择多张图片
3. 验证所有图片都正确导入
4. 验证图片排列是否整齐

### 大图片测试
1. 选择一张超过400px的大图片
2. 验证图片被正确缩放
3. 验证宽高比保持不变

### 格式测试
- 测试JPEG、PNG、GIF、WebP等格式
- 验证所有格式都能正确导入

## 版本历史

### v53 (当前版本)
- ✅ 修复TypeScript类型错误
- ✅ 使用正确的资产ID生成方式
- ✅ 完整实现图片导入功能

### v52
- ✅ 添加图片导入UI
- ✅ AI节点移至工具面板顶部
- ✅ 修复工具点击错误
